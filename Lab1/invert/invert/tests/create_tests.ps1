# create_tests.ps1
# Запуск: powershell -ExecutionPolicy Bypass -File create_tests.ps1

Set-StrictMode -Version Latest
$ErrorActionPreference = "Stop"

$base = if ($PSScriptRoot) { $PSScriptRoot } else { (Get-Location).Path }

foreach ($d in @("input", "expected", "output")) {
    $p = Join-Path $base $d
    if (!(Test-Path $p)) { New-Item -ItemType Directory $p | Out-Null }
}

function W([string]$relPath, [string]$content) {
    $full = Join-Path $base $relPath
    [System.IO.File]::WriteAllText($full, $content)
}

# =====================================================================
#  01  Целочисленная матрица (пример 1 из задания)
# =====================================================================
W "input\t01_input.txt" `
    "1`t2`t3`r`n0`t1`t4`r`n5`t6`t0`r`n"

W "expected\t01_expected.txt" `
    "-24.000`t18.000`t5.000`r`n20.000`t-15.000`t-4.000`r`n-5.000`t4.000`t1.000`r`n"

# =====================================================================
#  02  Дробные коэффициенты (пример 2)
# =====================================================================
W "input\t02_input.txt" `
    "4`t7`t2.3`r`n2`t1`t1`r`n3`t-2`t-2.31`r`n"

W "expected\t02_expected.txt" `
    "-0.009`t0.321`t0.131`r`n0.212`t-0.448`t0.017`r`n-0.194`t0.806`t-0.278`r`n"

# =====================================================================
#  03  Вырожденная матрица — det = 0 (пример 3)
# =====================================================================
W "input\t03_input.txt" `
    "1`t2`t3`r`n2`t4`t6`r`n1`t2`t3`r`n"

W "expected\t03_expected.txt" `
    "Non-invertible`r`n"

# =====================================================================
#  04  Нечисловое значение "a" (пример 4)
# =====================================================================
W "input\t04_input.txt" `
    "1`t2`ta`r`n2`t4`t6`r`n1`t2`t3`r`n"

W "expected\t04_expected.txt" `
    "Invalid matrix`r`n"

# =====================================================================
#  05  Частично числовой токен "3abc"
# =====================================================================
W "input\t05_input.txt" `
    "1`t2`t3abc`r`n2`t4`t6`r`n1`t2`t3`r`n"

W "expected\t05_expected.txt" `
    "Invalid matrix`r`n"

# =====================================================================
#  06  Только 2 строки (не хватает строки)
# =====================================================================
W "input\t06_input.txt" `
    "1`t2`t3`r`n4`t5`t6`r`n"

W "expected\t06_expected.txt" `
    "Invalid matrix format`r`n"

# =====================================================================
#  07  4 элемента в строке (лишний столбец)
# =====================================================================
W "input\t07_input.txt" `
    "1`t2`t3`t4`r`n5`t6`t7`t8`r`n9`t10`t11`t12`r`n"

W "expected\t07_expected.txt" `
    "Invalid matrix format`r`n"

# =====================================================================
#  08  2 элемента в строке (не хватает столбца)
# =====================================================================
W "input\t08_input.txt" `
    "1`t2`r`n3`t4`r`n5`t6`r`n"

W "expected\t08_expected.txt" `
    "Invalid matrix format`r`n"

# =====================================================================
#  09  Пустой файл
# =====================================================================
W "input\t09_input.txt" `
    ""

W "expected\t09_expected.txt" `
    "Invalid matrix format`r`n"

# =====================================================================
#  10  Единичная матрица — обратная = она же
# =====================================================================
W "input\t10_input.txt" `
    "1`t0`t0`r`n0`t1`t0`r`n0`t0`t1`r`n"

W "expected\t10_expected.txt" `
    "1.000`t0.000`t0.000`r`n0.000`t1.000`t0.000`r`n0.000`t0.000`t1.000`r`n"

# =====================================================================
#  11  Диагональная матрица diag(2,4,5) → diag(0.5, 0.25, 0.2)
# =====================================================================
W "input\t11_input.txt" `
    "2`t0`t0`r`n0`t4`t0`r`n0`t0`t5`r`n"

W "expected\t11_expected.txt" `
    "0.500`t0.000`t0.000`r`n0.000`t0.250`t0.000`r`n0.000`t0.000`t0.200`r`n"

# =====================================================================
#  12  Все отрицательные (кроме нулей), det = -1
# =====================================================================
W "input\t12_input.txt" `
    "-1`t-2`t-3`r`n0`t-1`t-4`r`n-5`t-6`t0`r`n"

W "expected\t12_expected.txt" `
    "24.000`t-18.000`t-5.000`r`n-20.000`t15.000`t4.000`r`n5.000`t-4.000`t-1.000`r`n"

# =====================================================================
#  13  Stdin через pipe (тот же вход, что и t01)
#      Входной файл не нужен — используется t01_input.txt через pipe
# =====================================================================
W "expected\t13_expected.txt" `
    "-24.000`t18.000`t5.000`r`n20.000`t-15.000`t-4.000`r`n-5.000`t4.000`t1.000`r`n"

# =====================================================================
#  14  Флаг -h  (справка)
#      ВАЖНО: количество табов должно совпадать с PrintHelp()
# =====================================================================
W "expected\t14_expected.txt" `
    "Usage:`r`n`tinvert.exe`t`t`tRead Matrix from stdin`r`n`tinvert.exe <file>`tRead Matrix from file`r`n`tinvert.exe -h`t`tShow help`r`n"

# =====================================================================
#  15  Несуществующий файл
# =====================================================================
W "expected\t15_expected.txt" `
    "Failed to open file: nonexistent.txt`r`n"

# =====================================================================
#  16  Слишком много аргументов
# =====================================================================
W "expected\t16_expected.txt" `
    "Too many arguments. Use -h for help.`r`n"

Write-Host "All test files created successfully in: $base"
Write-Host "  input\    - 12 files"
Write-Host "  expected\ - 16 files"
Write-Host "  output\   - (empty, filled by run_tests.bat)"